<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>@ViewData["Title"]</title>
  <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
  <link rel="stylesheet" href="~/Inmobiliaria.styles.css" asp-append-version="true" />
  <style>

  </style>

</head>

<body class="h-100">
  <!-- Alertas Globales -->
  <div id="alert-container" class="position-fixed top-0 start-50 translate-middle-x"
    style="z-index: 2001; width: 90%; max-width: 600px; pointer-events: none;">

    @if (TempData["Success"] != null || TempData["MensajeSuccess"] != null)
    {
      <div class="alert alert-success alertaTemp shadow mt-3 w-75 mx-auto" role="alert" style="pointer-events:auto;">
        @(TempData["Success"] ?? TempData["MensajeSuccess"])
      </div>
    }

    @if (TempData["Warning"] != null || TempData["MensajeWarning"] != null)
    {
      <div class="alert alert-warning alertaTemp shadow mt-3 w-75 mx-auto" role="alert" style="pointer-events:auto;">
        @(TempData["Warning"] ?? TempData["MensajeWarning"])
      </div>
    }

    @if (TempData["Error"] != null || TempData["MensajeError"] != null)
    {
      <div class="alert alert-danger alertaTemp shadow mt-3 w-75 mx-auto" role="alert" style="pointer-events:auto;">
        @(TempData["Error"] ?? TempData["MensajeError"])
      </div>
    }

    @if (TempData["Info"] != null || TempData["MensajeInfo"] != null)
    {
      <div class="alert alert-info alertaTemp shadow mt-3 w-75 mx-auto" role="alert" style="pointer-events:auto;">
        @(TempData["Info"] ?? TempData["MensajeInfo"])
      </div>
    }
  </div>


  <div class="d-flex">
    <nav id="sidebar" class="d-flex flex-column p-2">
      <button class="btn btn-sm btn-secondary mb-3" id="toggleSidebar">
        <i class="bi bi-list"></i>
      </button>

      <button class="btn btn-sm btn-light mb-2 d-md-none ms-auto" id="mobileClose" aria-label="Cerrar menú">
        <i class="bi bi-x-lg"> X </i>
      </button>
      <div class="sidebar-content">
        <ul class="nav nav-pills flex-column pt-5">
          <li class="nav-item mb-1">
            <a class="nav-link d-flex align-items-center" href="/">Inicio</a>
          </li>

          <li class="nav-item mb-1">
            <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse"
              href="#propietarioMenu">Propietarios</a>
            <div class="collapse" id="propietarioMenu">
              <ul class="btn-toggle-nav list-unstyled fw-normal small ps-4">
                <li><a class="nav-link color-gris py-1" asp-controller="Propietario" asp-action="Crear">Crear</a>
                </li>
                <li><a class="nav-link color-gris py-1" asp-controller="Propietario" asp-action="Listar">Lista
                    Gestion</a></li>
              </ul>
            </div>
          </li>

          <li class="nav-item mb-1">
            <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#inquilinoMenu">Inquilinos</a>
            <div class="collapse" id="inquilinoMenu">
              <ul class="btn-toggle-nav list-unstyled fw-normal small ps-4">
                <li><a class="nav-link color-gris py-1" asp-controller="Inquilino" asp-action="Crear">Crear</a></li>
                <li><a class="nav-link color-gris py-1" asp-controller="Inquilino" asp-action="Listar">Lista
                    Gestion</a></li>
              </ul>
            </div>
          </li>

          <li class="nav-item mb-1">
            <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#inmuebleMenu">Inmuebles</a>
            <div class="collapse" id="inmuebleMenu">
              <ul class="btn-toggle-nav list-unstyled fw-normal small ps-4">
                <li><a class="nav-link color-gris py-1" asp-controller="Inmueble" asp-action="Crear">Crear</a></li>
                <li><a class="nav-link color-gris py-1" asp-controller="Inmueble" asp-action="Listar">Lista
                    Gestion</a></li>
              </ul>
            </div>
          </li>

          <li class="nav-item mb-1">
            <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#tipoMenu">Tipos de
              Inmueble</a>
            <div class="collapse" id="tipoMenu">
              <ul class="btn-toggle-nav list-unstyled fw-normal small ps-4">
                <li><a class="nav-link color-gris py-1" asp-controller="TipoInmueble" asp-action="Crear">Crear</a>
                </li>
                <li><a class="nav-link color-gris py-1" asp-controller="TipoInmueble" asp-action="Listar">Lista
                    Gestion</a></li>
              </ul>
            </div>
          </li>

          <li class="nav-item mb-1">
            <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#contratoMenu">Contrato</a>
            <div class="collapse" id="contratoMenu">
              <ul class="btn-toggle-nav list-unstyled fw-normal small ps-4">
                <li><a class="nav-link color-gris py-1" asp-controller="Contrato" asp-action="Crear">Crear</a></li>
                <li><a class="nav-link color-gris py-1" asp-controller="Contrato" asp-action="Listar">Lista
                    Gestion</a></li>
              </ul>
            </div>
          </li>

          <li class="nav-item mb-1">
            <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#pagoMenu">Pago</a>
            <div class="collapse" id="pagoMenu">
              <ul class="btn-toggle-nav list-unstyled fw-normal small ps-4">
                <li><a class="nav-link color-gris py-1" asp-controller="Pago" asp-action="Crear">Crear</a></li>
                <li><a class="nav-link color-gris py-1" asp-controller="Pago" asp-action="Listar">Lista Gestion</a>
                </li>
              </ul>
            </div>
          </li>

        </ul>
      </div>

    </nav>

    <div class="flex-grow-1">
      <header class="d-flex justify-content-between align-items-center shadow-sm py-3 m-0 border-bottom">
        <div class="d-flex align-items-center">
          <button class="btn btn-outline-light d-md-none me-2" id="mobileToggle">
            <i class="bi bi-list"></i>
          </button>
          <h4 class="mb-0 fw-bold color-gris">@ViewData["SubTitle"]</h4>
        </div>

        <div class="d-flex align-items-center">
          <div class="dropdown">
            <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="userDropdown"
              data-bs-toggle="dropdown" aria-expanded="false">
              <img src="~/images/user.png" alt="Usuario" width="32" height="32" class="rounded-circle me-2">
              <span class="fw-semibold color-gris">Usuario</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="#">Perfil</a></li>
              <li><a class="dropdown-item" href="#">Configuración</a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="#">Cerrar sesión</a></li>
            </ul>
          </div>
        </div>
      </header>




      <main role="main " class="container-fluid p-4 bg-light">
        @RenderBody()
      </main>

    </div>
  </div>



  <script src="~/lib/jquery/dist/jquery.min.js"></script>
  <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="~/js/site.js" asp-append-version="true"></script>
  @await RenderSectionAsync("Scripts", required: false)
  <partial name="_ValidationScriptsPartial" />
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      tooltipTriggerList.forEach(el => new bootstrap.Tooltip(el))
      const sidebar = document.getElementById('sidebar');
      const toggleBtn = document.getElementById('toggleSidebar');
      const mobileToggle = document.getElementById('mobileToggle');
      const mobileClose = document.getElementById('mobileClose');
      const content = document.querySelector('.flex-grow-1');
      const sidebarContent = sidebar.querySelector('.sidebar-content');

      let backdrop = document.querySelector('.sidebar-backdrop');
      function ensureBackdrop() {
        if (!backdrop) {
          backdrop = document.createElement('div');
          backdrop.className = 'sidebar-backdrop';
          document.body.appendChild(backdrop);
        }
      }

      function openMobileSidebar() {
        sidebar.classList.remove('collapsed');

        ensureBackdrop();
        sidebar.classList.add('show');
        sidebar.style.left = '0';
        backdrop.classList.add('visible');
        document.body.style.overflow = 'hidden';
        sidebarContent.classList.remove('d-none');
      }

      function closeMobileSidebar() {
        if (!sidebar.classList.contains('show')) return;
        sidebar.classList.remove('show');
        if (backdrop) backdrop.classList.remove('visible');
        document.body.style.overflow = '';
        sidebar.style.left = '';
        if (backdrop && !backdrop.classList.contains('visible')) {
        }
      }

      document.querySelectorAll('#sidebar .nav-link').forEach(a => {
        if (a.querySelector('span')) return;
        const textParts = Array.from(a.childNodes)
          .filter(n => n.nodeType === Node.TEXT_NODE && n.textContent.trim().length)
          .map(n => n.textContent.trim());
        if (textParts.length) {
          Array.from(a.childNodes)
            .filter(n => n.nodeType === Node.TEXT_NODE)
            .forEach(n => n.remove());
          const span = document.createElement('span');
          span.textContent = textParts.join(' ');
          a.appendChild(span);
        }
      });

      if (sidebar.classList.contains('collapsed')) {
        sidebarContent.classList.add('d-none');
        content.style.marginLeft = '70px';
      } else {
        content.style.marginLeft = '220px';
      }

      if (toggleBtn) {
        toggleBtn.addEventListener('click', () => {
          sidebar.classList.toggle('collapsed');
          const isCollapsed = sidebar.classList.contains('collapsed');
          content.style.marginLeft = isCollapsed ? '70px' : '220px';
          if (isCollapsed) sidebarContent.classList.add('d-none');
          else sidebarContent.classList.remove('d-none');
        });
      }

      if (mobileToggle) {
        mobileToggle.addEventListener('click', (e) => {
          e.stopPropagation();
          if (sidebar.classList.contains('show')) closeMobileSidebar();
          else openMobileSidebar();
        });
      }

      if (mobileClose) {
        mobileClose.addEventListener('click', (e) => {
          e.stopPropagation();
          closeMobileSidebar();
        });
      }

      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 768 && sidebar.classList.contains('show')) {
          const clickedInside = sidebar.contains(e.target);
          const clickedToggle = mobileToggle && mobileToggle.contains(e.target);
          if (!clickedInside && !clickedToggle) closeMobileSidebar();
        }
      }, true);

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeMobileSidebar();
      });

      document.body.addEventListener('click', (e) => {
        if (backdrop && (e.target === backdrop || backdrop.contains(e.target))) {
          closeMobileSidebar();
        }
      });

      window.addEventListener('resize', () => {
        if (window.innerWidth <= 768) {
          sidebar.classList.remove('collapsed');
          content.style.marginLeft = '0';
        } else {
          closeMobileSidebar();
          sidebar.style.left = '';
          if (sidebar.classList.contains('collapsed')) {
            sidebarContent.classList.add('d-none');
            content.style.marginLeft = '70px';
          } else {
            sidebarContent.classList.remove('d-none');
            content.style.marginLeft = '220px';
          }
          if (backdrop) backdrop.classList.remove('visible');
        }
      });
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const alerts = document.querySelectorAll(".alertaTemp");
      alerts.forEach(alert => {
        setTimeout(() => {
          alert.classList.add("fade");
          alert.classList.add("show");
          setTimeout(() => alert.remove(), 500); // se elimina tras la animación
        }, 5000); // 5 segundos
      });
    });
  </script>


</body>

</html>