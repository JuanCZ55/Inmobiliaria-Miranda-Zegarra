@using System.Diagnostics
@model IEnumerable<Inmobiliaria.Models.Inmueble>

@{
  ViewData["Title"] = "Listado de Inmuebles";
  Layout = "~/Views/Shared/_Layout.cshtml";
  var paginaActual = ViewBag.PaginaActual ?? 1;
  var totalPaginas = ViewBag.TotalPaginas ?? 1;
  var direccionFiltro = ViewBag.Direccion ?? "";
  var dniFiltro = ViewBag.Dni ?? "";
  var idTipoFiltro = ViewBag.IdTipoInmueble ?? 0;
  var usoFiltro = ViewBag.Uso ?? 0;
  var ambientesFiltro = ViewBag.CantidadAmbientesMin ?? "";
  var precioMinFiltro = ViewBag.PrecioMin ?? "";
  var precioMaxFiltro = ViewBag.PrecioMax ?? "";
  var estadoFiltro = ViewBag.Estado ?? 0;
}

<h2>Listado de Inmuebles <a class="btn btn-primary" asp-controller="Inmueble" asp-action="Crear">+</a></h2>

<div class="container px-0 pt-3">
  <form method="get" asp-action="Listar" class="row g-2 mb-3">
    <div class="col-md-3">
      <div class="zeg-field">
        <input type="text" id="direccion" name="direccion" value="@direccionFiltro" class="zeg-input" placeholder=" " />
        <label for="direccion">Dirección</label>
      </div>
    </div>

    <div class="col-md-3">
      <div class="zeg-field">
        <input type="text" id="dni" name="dni" value="@dniFiltro" class="zeg-input" placeholder=" " />
        <label for="dni">DNI Propietario</label>
      </div>
    </div>

    <div class="col-md-3">
      <div class="zeg-field">
        <select id="idTipoInmueble" name="idTipoInmueble" class="zeg-input">
          <option value=""></option>
          @foreach (var tipo in ViewBag.Tipos)
          {@if (tipo.IdTipoInmueble == idTipoFiltro)
            {
              <option value="@tipo.IdTipoInmueble" selected>@tipo.Nombre</option>
            }
                    else
            {
              <option value="@tipo.IdTipoInmueble">@tipo.Nombre</option>
            }
          }
        </select>
        <label for="idTipoInmueble">Tipo de Inmueble</label>
      </div>
    </div>

    <div class="col-md-3">
      <div class="zeg-field">
        <select id="uso" name="uso" class="zeg-input">
          <option value=""></option>
          @if (usoFiltro == 1)
          {
            <option value="1" selected>Residencial</option>
          }
          else
          {
            <option value="1">Residencial</option>
          }
          @if (usoFiltro == 2)
          {
            <option value="2" selected>Comercial</option>
          }
          else
          {
            <option value="2">Comercial</option>
          }
        </select>
        <label for="uso">Uso</label>
      </div>
    </div>

    <div class="col-md-3">
      <div class="zeg-field">
        <input type="number" id="cantidadAmbientesMin" name="cantidadAmbientesMin" value="@ambientesFiltro"
          class="zeg-input" placeholder=" " />
        <label for="cantidadAmbientesMin">Mín. ambientes</label>
      </div>
    </div>

    <div class="col-md-3">
      <div class="zeg-field">
        <input type="number" id="precioMin" name="precioMin" value="@precioMinFiltro" class="zeg-input"
          placeholder=" " />
        <label for="precioMin">Precio mínimo</label>
      </div>
    </div>

    <div class="col-md-3">
      <div class="zeg-field">
        <input type="number" id="precioMax" name="precioMax" value="@precioMaxFiltro" class="zeg-input"
          placeholder=" " />
        <label for="precioMax">Precio máximo</label>
      </div>
    </div>

    <div class="col-md-3">
      <div class="zeg-field">
        <select id="estado" name="estado" class="zeg-input">
          <option value=""></option>
          @switch (estadoFiltro)
          {
            case 1:
              <option value="1" selected>Disponible</option>
              <option value="2">Ocupado</option>
              <option value="3">Suspendido</option>
              break;
            case 2:
              <option value="1">Disponible</option>
              <option value="2" selected>Ocupado</option>
              <option value="3">Suspendido</option>
              break;
            case 3:
              <option value="1">Disponible</option>
              <option value="2">Ocupado</option>
              <option value="3" selected>Suspendido</option>
              break;
            default:
              <option value="1">Disponible</option>
              <option value="2">Ocupado</option>
              <option value="3">Suspendido</option>
              break;
          }

        </select>
        <label for="estado">Estado</label>
      </div>
    </div>

    <div class="d-flex justify-content-end mt-0">
      <button type="submit" class="btn btn-primary">Filtrar</button>
    </div>
  </form>
</div>

<table class="table table-hover text-center table-light">
  <thead class="table-dark">
    <tr>
      <th>@Html.DisplayNameFor(model => model.First().IdInmueble)</th>
      <th>@Html.DisplayNameFor(model => model.First().Direccion)</th>
      <th>Propietario</th>
      <th>Tipo</th>
      <th>Uso</th>
      <th>@Html.DisplayNameFor(model => model.First().CantidadAmbientes)</th>
      @* <th>@Html.DisplayNameFor(model => model.First().Descripcion)</th> *@
      <th>@Html.DisplayNameFor(model => model.First().Precio)</th>
      <th>@Html.DisplayNameFor(model => model.First().Estado)</th>
      <th class="acciones">Acciones</th>
    </tr>
  </thead>
  <tbody>
    @foreach (var i in Model)
    {
      <tr>
        <td>@i.IdInmueble</td>
        <td>@i.Direccion</td>
        <td>@i.Propietario?.Nombre @i.Propietario?.Apellido</td>
        <td>@i.TipoInmueble?.Nombre</td>
        <td>@(i.Uso == 1 ? "Residencial" : "Comercial")</td>
        <td>@i.CantidadAmbientes</td>
        @* <td>@i.Descripcion</td> *@
        <td>@i.Precio</td>
        <td>
          @(i.Estado == 1 ? "Disponible" :
                  i.Estado == 2 ? "Ocupado" :
                  i.Estado == 3 ? "Suspendido" :
                  "Error")
        </td>
        <td>
          <div class="row acciones">

            <div class="col-md-4"><a asp-controller="Contrato" asp-action="Crear" asp-route-idInmueble="@i.IdInmueble"
                class="btn btn-primary btn-sm ">Contrato</a></div>
            <div class="col-md-4"><a asp-action="Modificar" asp-route-id="@i.IdInmueble"
                class="btn btn-warning btn-sm">Modificar</a></div>
            <div class="col-md-4">
              <form asp-action="Eliminar" asp-route-id="@i.IdInmueble" method="post"> <button type="submit"
                  class="btn btn-danger btn-sm">Eliminar</button> </form>
            </div>
          </div>
        </td>
      </tr>
    }
  </tbody>
</table>

@if (totalPaginas > 1)
{
  <nav>
    <ul class="pagination">
      @for (int i = 1; i <= totalPaginas; i++)
      {
        <li class="page-item @(i == paginaActual ? "active" : "")">
          <a class="page-link" asp-action="Listar" asp-route-direccion="@direccionFiltro" asp-route-dni="@dniFiltro"
            asp-route-idTipoInmueble="@idTipoFiltro" asp-route-uso="@usoFiltro"
            asp-route-cantidadAmbientesMin="@ambientesFiltro" asp-route-precioMin="@precioMinFiltro"
            asp-route-precioMax="@precioMaxFiltro" asp-route-estado="@estadoFiltro" asp-route-paginaActual="@i">@i</a>
        </li>
      }
    </ul>
  </nav>
}
<script>
  document.addEventListener("DOMContentLoaded", () => {

    document.querySelectorAll('select.zeg-input').forEach(select => {
      if (select.value !== "") select.classList.add('active');

      select.addEventListener('change', () => {
        if (select.value !== "") select.classList.add('active');
        else select.classList.remove('active');
      });
    });

    document.querySelectorAll('input.zeg-input, textarea.zeg-input').forEach(input => {
      if (input.value !== "") input.classList.add('active');
      input.addEventListener('input', () => {
        if (input.value !== "") input.classList.add('active');
        else input.classList.remove('active');
      });
    });

  });

</script>