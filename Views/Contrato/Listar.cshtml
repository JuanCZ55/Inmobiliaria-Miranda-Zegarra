@model IEnumerable<Inmobiliaria.Models.Contrato>

@{
  ViewData["Title"] = "Listado de Contratos";
  Layout = "~/Views/Shared/_Layout.cshtml";
  var PaginaActual = ViewBag.PaginaActual ?? 1;
  var totalPaginas = ViewBag.TotalPaginas ?? 1;
  var idContrato = ViewBag.IdContrato ?? "";
  var dniInquilino = ViewBag.DniInquilino ?? "";
  var idInmueble = ViewBag.IdInmueble ?? "";
  var estado = ViewBag.Estado ?? "";
  var Fecha_desde = ViewBag.FechaDesde ?? "";
  var Fecha_hasta = ViewBag.FechaHasta ?? "";
}

<h2>Listado de Contratos</h2>

<div class="row mb-3">
  <form action="Listar" method="get" class="row g-2 align-items-end">
    <div class="col-md-2">
      <label for="idContrato" class="form-label">Cod. Contrato</label>
      <input class="form-control" type="text" id="idContrato" name="idContrato" value="@idContrato"
        placeholder="Cod. Contrato" />
    </div>
    <div class="col-md-2">
      <label for="dniInquilino" class="form-label">DNI Inquilino</label>
      <input class="form-control" type="text" id="dniInquilino" name="dniInquilino" value="@dniInquilino"
        placeholder="DNI Inquilino" maxlength="8" />
    </div>
    <div class="col-md-2">
      <label for="idInmueble" class="form-label">Cod. Inmueble</label>
      <input class="form-control" type="text" id="idInmueble" name="idInmueble" value="@idInmueble"
        placeholder="Cod. Inmueble" />
    </div>

      <div class="col-md-2">
        <select class="form-control" name="estado">
            <option value="">Seleccionar estado</option>
            @if (estado == "1")
            {
                <option value="1" selected>Vigente</option>
            }
            else
            {
                <option value="1">Vigente</option>
            }

            @if (estado == "2")
            {
                <option value="2" selected>Finalizado</option>
            }
            else
            {
                <option value="2">Finalizado</option>
            }

            @if (estado == "3")
            {
                <option value="3" selected>Cancelado</option>
            }
            else
            {
                <option value="3">Cancelado</option>
            }
        </select>

      </div>

    <div class="col-md-2">
      <label for="Fecha_desde" class="form-label">Fecha desde</label>
      <input class="form-control" type="date" id="Fecha_desde" name="Fecha_desde" value="@Fecha_desde" />
    </div>
    <div class="col-md-2">
      <label for="Fecha_hasta" class="form-label">Fecha hasta</label>
      <input class="form-control" type="date" id="Fecha_hasta" name="Fecha_hasta" value="@Fecha_hasta" />
    </div>
    <div class="col-md-12 text-end mt-2">
      <button type="submit" class="btn btn-primary">Filtrar</button>
    </div>
  </form>
</div>

<table class="table table-hover table-striped table-bordered">
  <thead class="table-dark text-center">
    <tr>
      <th>@Html.DisplayNameFor(model => model.First().IdContrato)</th>
      <th>@Html.DisplayNameFor(model => model.First().IdInquilino)</th>
      <th>@Html.DisplayNameFor(model => model.First().IdInmueble)</th>
      <th>@Html.DisplayNameFor(model => model.First().MontoMensual)</th>
      <th>Fecha</th>
      <th>@Html.DisplayNameFor(model => model.First().Estado)</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody class="text-center">
    @if (Model != null && Model.Any())
    {
      foreach (var c in Model)
      {
        <tr>
          <td>@c.IdContrato</td>
          <td>@c.IdInquilino</td>
          <td>@c.IdInmueble</td>
          <td>@c.MontoMensual</td>
          <td>@c.FechaDesde.ToShortDateString() - @c.FechaHasta.ToShortDateString()</td>
          <td>@(c.Estado == 1 ? "Vigente" : c.Estado == 2 ? "Finalizado" : c.Estado == 3 ? "Cancelado" : "Desconocido")</td>
          <td>
            <a asp-action="Ver" asp-route-id="@c.IdContrato" class="btn btn-warning btn-sm">Ver</a>
          </td>
        </tr>
      }
    }
    else
    {
      <tr>
        <td colspan="7">No se encontraron Contratos</td>
      </tr>
    }
  </tbody>
</table>

@if (totalPaginas > 1)
{
  <nav aria-label="PaginaciÃ³n">
    <ul class="pagination justify-content-center">
      @for (int i = 1; i <= totalPaginas; i++)
      {
        <li class="page-item @(i == PaginaActual ? "active" : "")">
          <a class="page-link" asp-action="Listar" asp-route-idContrato="@idContrato" asp-route-dniInquilino="@dniInquilino"
            asp-route-idInmueble="@idInmueble" asp-route-estado="@estado" asp-route-Fecha_desde="@Fecha_desde"
            asp-route-Fecha_hasta="@Fecha_hasta" asp-route-PaginaActual="@i">@i</a>
        </li>
      }
    </ul>
  </nav>
}

@if (TempData["Mensaje"] != null)
{
  <div class="alert alert-success">@TempData["Mensaje"]</div>
}
