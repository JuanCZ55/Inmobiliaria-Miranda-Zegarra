@model IEnumerable<Inmobiliaria.Models.Pago>

@{
  ViewData["Title"] = "Listado de Pagos";
  ViewData["SubTitle"] = "Pagos";
  Layout = "~/Views/Shared/_Layout.cshtml";
  var PaginaActual = ViewBag.PaginaActual ?? 1;
  var totalPaginas = ViewBag.TotalPaginas ?? 1;
  var idPago = ViewBag.IdPago ?? "";
  var idContrato = ViewBag.IdContrato ?? "";
  var dniInquilino = ViewBag.DniInquilino ?? "";
  var MontoMenor = ViewBag.MontoMenor ?? "";
  var MontoMayor = ViewBag.MontoMayor ?? "";
  var estado = ViewBag.estado ?? "";
  var Fecha_desde = ViewBag.FechaDesde ?? "";
  var Fecha_hasta = ViewBag.FechaHasta ?? "";
  var estados = ViewBag.estado ?? "";
}

<div class="d-flex align-items-center mb-3">
  <h2 class="text-center py-4">@ViewData["Title"]</h2>

  <a class="btn btn-primary ms-3" asp-action="Crear">
    <img class="invert-color-icon" src="~/images/icon/Agregar.png" alt="">
  </a>
</div>

<div class="d-flex flex-column pt-4">
  <form asp-action="Listar" method="get" class="row g-2 bg-white shadow-sm rounded p-3">
    <div class="row">
      <div class="col-md-12 d-flex justify-content-start align-items-center pb-2">
        <h4 class="ps-2 pe-3 m-0 fw-bold">Filtrar</h4>
      </div>
      <div class="col-md-2">
        <div class="zeg-field">
          <input class="zeg-input" type="text" id="idPago" name="idPago" value="@idPago" placeholder="" />
          <label for="idPago">Cod. Pago</label>
        </div>
      </div>
      <div class="col-md-2">
        <div class="zeg-field">
          <input class="zeg-input" type="text" id="idContrato" name="idContrato" value="@idContrato"
            placeholder="Cod. Contrato" maxlength="8" />
          <label for="idContrato">Cod. Contrato</label>
        </div>
      </div>
      <div class="col-md-2">
        <div class="zeg-field">
          <input class="zeg-input" type="text" id="dniInquilino" name="dniInquilino" value="@dniInquilino"
            placeholder="DNI Inquilino" maxlength="8" />
          <label for="dniInquilino">DNI Inquilino</label>
        </div>
      </div>
      <div class="col-md-2">
        <div class="zeg-field">
          <select class="zeg-input" name="estado">
            <option value="" class="d-none"></option>
            <option value=" ">Todos</option>
            @if (estado == "1")
            {
              <option value="1" selected>Activo</option>
            }
            else
            {

              <option value="1">Activo</option>
            }
            @if (estado == "2")
            {
              <option value="2" selected>Cancelado</option>
            }
            else
            {

              <option value="2">Cancelado
              </option>
            }
          </select>
          <label for="estado">Estado</label>
        </div>
      </div>
      <div class="col-md-2">
        <div class="zeg-field">
          <input class="zeg-input" type="number" id="MontoMenor" name="MontoMenor" value="@MontoMenor"
            placeholder=" " />
          <label for="MontoMenor">Monto desde</label>
        </div>
      </div>
      <div class="col-md-2">
        <div class="zeg-field">
          <input class="zeg-input" type="number" id="MontoMayor" name="MontoMayor" value="@MontoMayor" placeholder=" ">
          <label for="MontoMayor">Monto hasta</label>
        </div>
      </div>
      <div class="col-md-2">
        <div class="zeg-field">
          <input class="zeg-input-date" type="date" id="FechaDesde" name="FechaDesde" value="@Fecha_desde"
            placeholder=" " />
          <label for="FechaDesde">Fecha desde</label>
        </div>
      </div>
      <div class="col-md-2">
        <div class="zeg-field">
          <input class="zeg-input-date" type="date" id="FechaHasta" name="FechaHasta" value="@Fecha_hasta"
            placeholder=" " />
          <label for="FechaHasta">Fecha hasta &nbsp;</label>
        </div>
      </div>
      <div class="col-md-2 d-flex justify-content-start align-items-center pb-3">
        <button type="submit" class="btn btn-outline-primary fw-bold">Filtrar</button>
      </div>
    </div>
  </form>
</div>

<div class="table-responsive shadow-sm rounded mt-4">
  <table class="table table-hover table-striped align-middle mb-0">
    <thead class="bg-primary text-white text-center">
      <th>@Html.DisplayNameFor(model => model.First().IdPago)</th>
      </th>
      <th>@Html.DisplayNameFor(model => model.First().IdContrato)</th>
      <th>@Html.DisplayNameFor(model => model.First().numeroPago)</th>
      <th>@Html.DisplayNameFor(model => model.First().FechaPago)</th>
      <th>@Html.DisplayNameFor(model => model.First().Concepto)</th>
      <th>@Html.DisplayNameFor(model => model.First().Monto)</th>
      <th>@Html.DisplayNameFor(model => model.First().Estado)</th>
      <th>Acciones</th>
    </thead>
    <tbody class="text-center">
      @if (Model != null && Model.Any())
      {
        @foreach (var i in Model)
        {
          <tr>
            <td>@i.IdPago</td>
            <td>@i.IdContrato</td>
            <td>@i.numeroPago</td>
            <td>@i.FechaPago.ToShortDateString()</td>
            <td>@i.Concepto</td>
            <td>@i.Monto</td>
            <td>@(i.Estado == 1 ? "Activo" : i.Estado == 2 ? "Cancelado" : "Desconocido")
            </td>
            <td class="d-flex justify-content-evenly">
              <a href="/Pago/ver?id=@i.IdPago" data-bs-toggle="tooltip" title="Ver Pago">
                <img src="~/images/icon/Gestionar.png" alt="Gestionar" />
              </a>
            </td>
          </tr>
        }
      }
      else
      {
        <tr>
          <td colspan="7" class="text-center">No se encontraron Pagos</td>
        </tr>
      }
    </tbody>
  </table>

</div>
<div id="tooltip-info" class="rounded"
  style="display:none; width:300px; position:absolute; background:#fff; border:1px solid #ccc; padding:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); z-index:9999;">
</div>
@if (totalPaginas > 1)
{
  <nav aria-label="PaginaciÃ³n" class="mt-3">
    <ul class="pagination justify-content-center">
      @for (int i = 1; i <= totalPaginas; i++)
      {
        <li class="page-item @(i == PaginaActual ? "active" : "")">
          <a class="page-link" asp-action="Listar" asp-route-idPago="@idPago" asp-route-idContrato="@idContrato"
            asp-route-dniInquilino="@dniInquilino" asp-route-estado="@estado" asp-route-FechaDesde="@Fecha_desde"
            asp-route-FechaHasta="@Fecha_hasta" asp-route-PaginaActual="@i">@i</a>
        </li>
      }
    </ul>
  </nav>
}


<script>
  document.addEventListener("DOMContentLoaded", () => {

    document.querySelectorAll('select.zeg-input').forEach(select => {
      if (select.value !== "") select.classList.add('active');

      select.addEventListener('change', () => {
        if (select.value !== "") select.classList.add('active');
        else select.classList.remove('active');
      });
    });

    document.querySelectorAll('input.zeg-input, textarea.zeg-input').forEach(input => {
      if (input.value !== "") input.classList.add('active');
      input.addEventListener('input', () => {
        if (input.value !== "") input.classList.add('active');
        else input.classList.remove('active');
      });
    });


    document.querySelectorAll('input.zeg-input-date[type="date"]').forEach(input => {

      const checkDateActive = () => {
        const val = input.value;

        // Validar fecha
        const isValidDate = (val) => {
          if (!val || val.trim() === "" || val === "0000-00-00" || val.toLowerCase() === "dd/mm/aaaa") return false;
          const d = new Date(val);
          return !isNaN(d.getTime());
        };

        if (isValidDate(val)) {
          input.classList.add('active');
        } else {
          input.classList.remove('active');
        }
      };

      // Inicial
      checkDateActive();

      // Eventos
      input.addEventListener('input', checkDateActive);
      input.addEventListener('change', checkDateActive);
    });
  });

</script>
